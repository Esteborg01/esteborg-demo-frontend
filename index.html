<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Demo Esteborg Ejecutivo</title>

  <style>
    :root {
      --bg-main: #050509;
      --bg-gradient-start: #151521;
      --bg-gradient-end: #050509;
      --card-bg: #0c0c14;
      --card-inner: #101018;
      --accent: #d8b15a;
      --accent-soft: #b89446;
      --accent-strong: #f2cf70;
      --accent-alt: #8fd8ff;
      --danger: #ff6b6b;
      --success: #46d88a;
      --text-main: #f5f5ff;
      --text-soft: #c3c3d8;
      --text-dim: #7e7e9c;
      --border-subtle: #232334;
      --shadow-soft: 0 24px 70px rgba(0, 0, 0, 0.65);
      --radius-lg: 24px;
      --radius-xl: 32px;
      --radius-pill: 999px;
      --glass: rgba(15, 15, 30, 0.82);
      --glass-strong: rgba(15, 15, 30, 0.95);
      --chip-bg: rgba(216, 177, 90, 0.12);
      --chip-border: rgba(216, 177, 90, 0.3);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Inter", sans-serif;
      background: radial-gradient(circle at top, #262042 0, #050509 55%, #020208 100%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 32px 12px 48px;
    }

    .bg-overlay {
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: 0.65;
      z-index: -1;
      background:
        radial-gradient(circle at 12% 0%, rgba(155, 120, 255, 0.18) 0, transparent 55%),
        radial-gradient(circle at 90% 10%, rgba(248, 203, 112, 0.18) 0, transparent 55%),
        radial-gradient(circle at 10% 100%, rgba(95, 216, 149, 0.14) 0, transparent 50%);
    }

    .app-shell {
      width: 100%;
      max-width: 1120px;
      display: grid;
      grid-template-columns: minmax(0, 3.2fr) minmax(0, 2.2fr);
      gap: 28px;
      align-items: stretch;
    }

    @media (max-width: 980px) {
      .app-shell {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card-main {
      position: relative;
      background: radial-gradient(circle at top left, #262042 0, #050509 52%);
      border-radius: var(--radius-xl);
      padding: 20px 20px 18px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(143, 142, 182, 0.26);
      overflow: hidden;
    }

    @media (min-width: 900px) {
      .card-main {
        padding: 22px 22px 18px;
      }
    }

    .card-main::before {
      content: "";
      position: absolute;
      inset: -120px;
      background:
        radial-gradient(circle at top, rgba(216, 177, 90, 0.18) 0, transparent 55%),
        radial-gradient(circle at 80% 120%, rgba(109, 159, 255, 0.18) 0, transparent 55%);
      opacity: 0.75;
      z-index: -1;
    }

    .card-main-inner {
      position: relative;
      border-radius: 20px;
      background: linear-gradient(
        145deg,
        rgba(9, 9, 18, 0.95),
        rgba(12, 12, 22, 0.98),
        rgba(6, 7, 18, 0.98)
      );
      border: 1px solid rgba(138, 137, 184, 0.4);
      box-shadow: 0 22px 70px rgba(0, 0, 0, 0.75);
      padding: 18px;
      overflow: hidden;
    }

    @media (min-width: 900px) {
      .card-main-inner {
        padding: 20px 20px 18px;
      }
    }

    .card-main-inner::before {
      content: "";
      position: absolute;
      inset: -2px;
      border-radius: inherit;
      border: 1px solid transparent;
      background: linear-gradient(145deg, rgba(249, 221, 140, 0.25), rgba(140, 127, 246, 0.2))
        border-box;
      -webkit-mask:
        linear-gradient(#000 0 0) padding-box,
        linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      opacity: 0.8;
      pointer-events: none;
    }

    .card-main-inner::after {
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at top left, rgba(216, 177, 90, 0.12) 0, transparent 50%),
        radial-gradient(circle at bottom right, rgba(143, 216, 210, 0.15) 0, transparent 55%);
      opacity: 0.9;
      z-index: -1;
    }

    .card-sidebar {
      position: relative;
      border-radius: var(--radius-xl);
      background: radial-gradient(circle at 0 0, #262043 0, #050509 55%);
      padding: 18px 16px 15px;
      border: 1px solid rgba(143, 142, 182, 0.35);
      box-shadow: 0 18px 55px rgba(0, 0, 0, 0.7);
      overflow: hidden;
    }

    @media (min-width: 900px) {
      .card-sidebar {
        padding: 20px 18px 16px;
      }
    }

    .card-sidebar::before {
      content: "";
      position: absolute;
      inset: -120px;
      background:
        radial-gradient(circle at 12% 0%, rgba(216, 177, 90, 0.1) 0, transparent 50%),
        radial-gradient(circle at 80% 100%, rgba(124, 208, 188, 0.14) 0, transparent 55%);
      opacity: 0.8;
      z-index: -1;
    }

    .sidebar-inner {
      position: relative;
      border-radius: 20px;
      background: linear-gradient(145deg, rgba(8, 10, 25, 0.94), rgba(5, 6, 18, 0.98));
      border: 1px solid rgba(141, 140, 194, 0.5);
      padding: 16px;
      box-shadow: 0 18px 60px rgba(0, 0, 0, 0.8);
    }

    @media (min-width: 900px) {
      .sidebar-inner {
        padding: 18px 16px 16px;
      }
    }

    .sidebar-inner::before {
      content: "";
      position: absolute;
      inset: -2px;
      border-radius: inherit;
      border: 1px solid transparent;
      background: linear-gradient(145deg, rgba(249, 221, 140, 0.25), rgba(140, 127, 246, 0.22))
        border-box;
      -webkit-mask:
        linear-gradient(#000 0 0) padding-box,
        linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      opacity: 0.8;
      pointer-events: none;
    }

    .sidebar-inner::after {
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at top left, rgba(216, 177, 90, 0.08) 0, transparent 55%),
        radial-gradient(circle at bottom right, rgba(143, 216, 210, 0.12) 0, transparent 60%);
      opacity: 0.8;
      z-index: -1;
    }

    .logo-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 14px;
    }

    .logo-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-mark {
      width: 40px;
      height: 40px;
      border-radius: 18px;
      background: radial-gradient(circle at 30% 10%, #f8e089 0, #f1c967 18%, #8c46ff 42%, #32127b 82%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow:
        0 0 0 1px rgba(255, 255, 255, 0.12),
        0 12px 30px rgba(0, 0, 0, 0.7);
      position: relative;
      overflow: hidden;
    }

    .logo-mark::before {
      content: "";
      position: absolute;
      inset: 6px;
      border-radius: 14px;
      background: radial-gradient(circle at 18% 0, #f8eeca 0, #f1c45d 24%, #ba7dff 58%, #361788 90%);
      opacity: 0.92;
    }

    .logo-mark::after {
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.36) 0, transparent 48%),
        radial-gradient(circle at 120% 120%, rgba(0, 0, 0, 0.7) 0, transparent 55%);
      mix-blend-mode: screen;
      opacity: 0.75;
    }

    .logo-mark-inner {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo-mark-inner svg {
      width: 26px;
      height: 26px;
      filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.65));
    }

    .logo-text-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .logo-title {
      font-size: 1.08rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      font-weight: 650;
      color: var(--text-main);
      display: flex;
      align-items: baseline;
      gap: 6px;
    }

    .logo-title span {
      display: inline-block;
    }

    .logo-title span.accent {
      color: var(--accent-strong);
    }

    .logo-subtitle {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-dim);
    }

    .logo-tag {
      border-radius: var(--radius-pill);
      padding: 5px 10px;
      font-size: 0.7rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      border: 1px solid rgba(191, 190, 232, 0.58);
      color: var(--text-soft);
      background: radial-gradient(circle at 0 0, rgba(201, 172, 95, 0.25), transparent 70%);
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .logo-tag-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--success);
      box-shadow: 0 0 0 4px rgba(70, 216, 138, 0.28);
    }

    .headline {
      margin-bottom: 10px;
    }

    .headline-kicker {
      font-size: 0.8rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--accent-soft);
      margin-bottom: 6px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .headline-kicker::before {
      content: "";
      width: 26px;
      height: 1px;
      background: linear-gradient(90deg, rgba(216, 177, 90, 0), rgba(216, 177, 90, 0.9));
    }

    .headline-title {
      font-size: clamp(1.7rem, 2.2vw, 2rem);
      line-height: 1.25;
      margin: 0 0 6px;
      font-weight: 680;
      letter-spacing: 0.015em;
    }

    .headline-highlight {
      color: var(--accent-strong);
    }

    .headline-subtitle {
      font-size: 0.9rem;
      color: var(--text-soft);
      max-width: 460px;
    }

    .headline-subtitle strong {
      color: var(--accent-soft);
      font-weight: 550;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 14px 0 10px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border-radius: 999px;
      padding: 6px 12px 6px 7px;
      border: 1px solid rgba(191, 190, 232, 0.38);
      background: radial-gradient(circle at 0 0, rgba(216, 177, 90, 0.18), transparent 65%);
      box-shadow: 0 8px 22px rgba(0, 0, 0, 0.5);
      font-size: 0.78rem;
      color: var(--text-soft);
    }

    .pill-icon {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at 30% 0, rgba(248, 222, 145, 0.9) 0, #d8b15a 40%, #8c46ff 100%);
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.5);
      color: #0c0c14;
      font-size: 0.7rem;
      font-weight: 650;
    }

    .pill strong {
      color: var(--accent-strong);
      font-weight: 600;
    }

    .pill-secondary {
      border-color: rgba(143, 216, 210, 0.55);
      background: radial-gradient(circle at 0 0, rgba(143, 216, 210, 0.18), transparent 60%);
    }

    .pill-secondary strong {
      color: var(--accent-alt);
    }

    .pill-subtle {
      border-color: rgba(109, 159, 255, 0.45);
      background: radial-gradient(circle at 0 0, rgba(109, 159, 255, 0.18), transparent 60%);
    }

    .pill-subtle strong {
      color: #9fb6ff;
    }

    .layout-main {
      display: grid;
      grid-template-columns: minmax(0, 3.2fr) minmax(0, 2.3fr);
      gap: 18px;
      align-items: stretch;
      margin-top: 12px;
      min-height: 380px;
    }

    @media (max-width: 880px) {
      .layout-main {
        grid-template-columns: minmax(0, 1fr);
        min-height: auto;
      }
    }

    .chat-panel {
      position: relative;
      border-radius: 18px;
      background: linear-gradient(145deg, rgba(8, 9, 22, 0.98), rgba(7, 8, 20, 0.98));
      border: 1px solid rgba(109, 108, 170, 0.55);
      box-shadow: 0 16px 55px rgba(0, 0, 0, 0.8);
      padding: 12px 12px 10px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    @media (min-width: 900px) {
      .chat-panel {
        padding: 14px 14px 12px;
      }
    }

    .chat-panel::before {
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at top, rgba(216, 177, 90, 0.12) 0, transparent 60%),
        radial-gradient(circle at bottom right, rgba(143, 216, 210, 0.15) 0, transparent 65%);
      opacity: 0.85;
      pointer-events: none;
      z-index: -1;
    }

    .chat-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      gap: 10px;
    }

    .chat-header-left {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .chat-title {
      font-size: 0.9rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .chat-title span.badge {
      font-size: 0.7rem;
      border-radius: 999px;
      padding: 2px 8px;
      border: 1px solid rgba(216, 177, 90, 0.65);
      background: rgba(216, 177, 90, 0.12);
      color: var(--accent-strong);
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .chat-subtitle {
      font-size: 0.78rem;
      color: var(--text-dim);
    }

    .chat-header-right {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.74rem;
      color: var(--text-dim);
    }

    .demo-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--accent-strong);
      box-shadow: 0 0 0 4px rgba(216, 177, 90, 0.32);
    }

    .demo-tag {
      border-radius: 999px;
      padding: 3px 8px;
      background: rgba(231, 196, 118, 0.1);
      border: 1px solid rgba(231, 196, 118, 0.35);
      color: var(--accent-strong);
      text-transform: uppercase;
      letter-spacing: 0.13em;
    }

    .chat-box {
      flex: 1;
      min-height: 220px;
      max-height: 340px;
      border-radius: 12px;
      padding: 10px 9px;
      background: radial-gradient(circle at top, rgba(32, 32, 64, 0.9) 0, rgba(8, 9, 20, 0.98) 42%);
      border: 1px solid rgba(84, 84, 133, 0.8);
      overflow-y: auto;
      box-shadow:
        inset 0 0 0 1px rgba(5, 5, 12, 0.8),
        0 14px 40px rgba(0, 0, 0, 0.75);
      scroll-behavior: smooth;
    }

    .chat-box::-webkit-scrollbar {
      width: 6px;
    }

    .chat-box::-webkit-scrollbar-track {
      background: transparent;
    }

    .chat-box::-webkit-scrollbar-thumb {
      background: rgba(110, 110, 160, 0.7);
      border-radius: 999px;
    }

    .msg-row {
      display: flex;
      margin-bottom: 8px;
    }

    .msg-row.user {
      justify-content: flex-end;
    }

    .bubble {
      position: relative;
      max-width: 80%;
      padding: 7px 9px 7px;
      border-radius: 13px;
      font-size: 0.78rem;
      line-height: 1.45;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.65);
      border: 1px solid transparent;
      word-wrap: break-word;
      white-space: pre-wrap;
    }

    .bubble-user {
      background: linear-gradient(135deg, #f1ca63, #f6e29e);
      color: #1c1407;
      align-self: flex-end;
      border-color: rgba(115, 85, 34, 0.52);
    }

    .bubble-user strong {
      color: #1c1407;
    }

    .bubble-ai {
      background: radial-gradient(circle at top left, rgba(17, 18, 32, 0.98), rgba(11, 12, 24, 0.98));
      color: var(--text-main);
      border-color: rgba(135, 134, 202, 0.62);
    }

    .bubble-ai strong {
      color: var(--accent-strong);
    }

    .bubble-ai a {
      color: var(--accent-alt);
      text-decoration: none;
      border-bottom: 1px dotted rgba(143, 216, 210, 0.7);
    }

    .bubble-ai a:hover {
      opacity: 0.9;
    }

    .bubble-label {
      font-size: 0.68rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      margin-bottom: 3px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--text-dim);
    }

    .bubble-label-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
    }

    .bubble-meta {
      font-size: 0.66rem;
      color: var(--text-dim);
      margin-top: 2px;
      display: flex;
      justify-content: flex-end;
      gap: 6px;
    }

    .input-row {
      display: flex;
      align-items: stretch;
      gap: 8px;
      margin-top: 9px;
    }

    .input-wrapper {
      position: relative;
      flex: 1;
      display: flex;
      align-items: center;
    }

    #userMsg {
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(124, 124, 180, 0.65);
      background: radial-gradient(circle at top left, rgba(26, 26, 52, 0.9), rgba(8, 9, 20, 0.98));
      color: var(--text-main);
      padding: 8px 103px 8px 12px;
      font-size: 0.8rem;
      outline: none;
      box-shadow:
        0 0 0 1px rgba(0, 0, 0, 0.7),
        0 10px 25px rgba(0, 0, 0, 0.75);
    }

    #userMsg::placeholder {
      color: rgba(159, 159, 210, 0.72);
    }

    .mic-btn {
      position: absolute;
      right: 98px;
      top: 50%;
      transform: translateY(-50%);
      width: 24px;
      height: 24px;
      border-radius: 999px;
      border: 1px solid rgba(143, 216, 210, 0.7);
      background: radial-gradient(circle at 30% 0, rgba(143, 216, 210, 0.7), #3b8a7b);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.7);
      color: #071412;
    }

    .mic-btn svg {
      width: 13px;
      height: 13px;
    }

    .mic-btn.recording {
      animation: pulse 1s infinite;
      border-color: rgba(255, 107, 107, 0.9);
      background: radial-gradient(circle at 30% 0, rgba(255, 143, 143, 0.85), #ff6b6b);
      color: #220606;
    }

    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.75);
      }
      70% {
        box-shadow: 0 0 0 10px rgba(255, 107, 107, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(255, 107, 107, 0);
      }
    }

    #sendBtn {
      border-radius: 999px;
      border: none;
      padding: 0 14px;
      font-size: 0.8rem;
      font-weight: 560;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      background: linear-gradient(135deg, #f1ca63, #f6e29e);
      color: #21140a;
      cursor: pointer;
      min-width: 128px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      box-shadow:
        0 8px 22px rgba(0, 0, 0, 0.75),
        0 0 0 1px rgba(0, 0, 0, 0.7);
      position: relative;
      overflow: hidden;
    }

    #sendBtn span.icon {
      font-size: 0.86rem;
    }

    #sendBtn:disabled {
      opacity: 0.62;
      cursor: default;
      box-shadow:
        0 4px 16px rgba(0, 0, 0, 0.7),
        0 0 0 1px rgba(0, 0, 0, 0.7);
    }

    #sendBtn::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(
        135deg,
        rgba(255, 255, 255, 0.4),
        rgba(255, 255, 255, 0.1),
        transparent
      );
      opacity: 0;
      transition: opacity 0.15s ease-out;
      mix-blend-mode: screen;
      pointer-events: none;
    }

    #sendBtn:hover:not(:disabled)::after {
      opacity: 0.9;
    }

    .demo-note {
      margin-top: 7px;
      font-size: 0.72rem;
      color: var(--text-dim);
    }

    .demo-note a {
      color: var(--accent-strong);
      text-decoration: none;
    }

    .hint-row {
      margin-top: 4px;
      font-size: 0.72rem;
      color: var(--text-dim);
    }

    .hint-row strong {
      color: var(--accent-strong);
    }

    .starter-row {
      margin-top: 8px;
      margin-bottom: 6px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .starter-chip {
      border-radius: 999px;
      padding: 5px 9px;
      font-size: 0.72rem;
      border: 1px solid rgba(191, 190, 232, 0.46);
      background: rgba(25, 24, 72, 0.9);
      color: var(--text-soft);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }

    .starter-chip:hover {
      border-color: rgba(216, 177, 90, 0.75);
      color: var(--accent-strong);
    }

    .starter-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent);
    }

    .status-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
      font-size: 0.72rem;
      color: var(--text-dim);
    }

    #demoStatus {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent-strong);
      box-shadow: 0 0 0 4px rgba(216, 177, 90, 0.28);
    }

    .status-dot.ended {
      background: var(--danger);
      box-shadow: 0 0 0 4px rgba(255, 107, 107, 0.28);
    }

    #ttsToggle {
      border-radius: 999px;
      padding: 3px 9px;
      border: 1px solid rgba(143, 216, 210, 0.8);
      background: rgba(7, 26, 24, 0.95);
      color: #9fe9c7;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    #ttsToggle.off {
      opacity: 0.55;
      border-color: rgba(94, 93, 140, 0.9);
      background: rgba(12, 12, 26, 0.96);
      color: var(--text-dim);
    }

    .sidebar-header {
      display: flex;
      flex-direction: column;
      gap: 5px;
      margin-bottom: 10px;
    }

    .sidebar-title {
      font-size: 0.95rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .badge-mini {
      border-radius: 999px;
      padding: 2px 7px;
      font-size: 0.68rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      border: 1px solid rgba(216, 177, 90, 0.7);
      background: rgba(216, 177, 90, 0.14);
      color: var(--accent-strong);
    }

    .sidebar-sub {
      font-size: 0.78rem;
      color: var(--text-dim);
      max-width: 260px;
    }

    .sidebar-sub strong {
      color: var(--accent-strong);
    }

    .divider {
      height: 1px;
      background: linear-gradient(90deg, rgba(191, 190, 232, 0.1), rgba(191, 190, 232, 0.6), rgba(191, 190, 232, 0.1));
      margin: 9px 0 10px;
    }

    .steps {
      display: grid;
      grid-template-columns: minmax(0, 1.5fr) minmax(0, 1.5fr);
      gap: 8px;
    }

    @media (max-width: 980px) {
      .steps {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .step-card {
      border-radius: 14px;
      padding: 8px 9px 9px;
      background: radial-gradient(circle at 0 0, rgba(216, 177, 90, 0.18), transparent 75%);
      border: 1px solid rgba(191, 190, 232, 0.55);
      font-size: 0.76rem;
    }

    .step-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border-radius: 999px;
      padding: 3px 8px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      border: 1px solid rgba(216, 177, 90, 0.65);
      background: rgba(216, 177, 90, 0.12);
      color: var(--accent-strong);
      margin-bottom: 4px;
    }

    .step-pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent-strong);
    }

    .step-title {
      font-weight: 560;
      margin-bottom: 4px;
    }

    .step-text {
      color: var(--text-soft);
    }

    .step-text strong {
      color: var(--accent-strong);
    }

    .step-card.alt {
      background: radial-gradient(circle at 0 0, rgba(143, 216, 210, 0.18), transparent 75%);
      border-color: rgba(143, 216, 210, 0.55);
    }

    .step-card.alt .step-pill {
      border-color: rgba(143, 216, 210, 0.8);
      background: rgba(143, 216, 210, 0.12);
      color: var(--accent-alt);
    }

    .step-card.alt .step-pill-dot {
      background: var(--accent-alt);
    }

    .step-card.alt .step-text strong {
      color: var(--accent-alt);
    }

    .metric-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      gap: 10px;
    }

    .metric-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      flex: 1;
    }

    .metric-item {
      min-width: 120px;
    }

    .metric-label {
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 0.65rem;
      color: var(--text-dim);
      margin-bottom: 4px;
    }

    .metric-value {
      font-size: 0.9rem;
      color: var(--text-main);
      display: flex;
      align-items: baseline;
      gap: 6px;
    }

    .metric-value span.small {
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-dim);
    }

    .metric-pill {
      border-radius: 999px;
      padding: 3px 8px;
      border: 1px solid rgba(109, 159, 255, 0.7);
      background: rgba(25, 47, 96, 0.9);
      font-size: 0.7rem;
      color: #aecdff;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .metric-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: rgba(109, 159, 255, 1);
    }

    .cta-members {
      font-size: 0.78rem;
      color: var(--text-dim);
      margin-top: 10px;
    }

    .cta-members a {
      color: var(--accent-strong);
      text-decoration: none;
    }

    .cta-members a:hover {
      text-decoration: underline;
    }

    .badge-demo {
      border-radius: 999px;
      padding: 3px 8px;
      font-size: 0.68rem;
      text-transform: uppercase;
      letter-spacing: 0.13em;
      border: 1px solid rgba(191, 190, 232, 0.6);
      color: var(--text-soft);
      background: rgba(10, 10, 32, 0.95);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .badge-demo-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent-strong);
    }

    .headline-top {
      margin-bottom: 4px;
      font-size: 1.02rem;
      font-weight: 600;
    }

    .headline-top span {
      color: var(--accent-strong);
    }

    .headline-main {
      font-size: 1.35rem;
      line-height: 1.35;
      margin-bottom: 4px;
      font-weight: 650;
    }

    .headline-main span {
      color: var(--accent-strong);
    }

    .headline-support {
      font-size: 0.82rem;
      color: var(--text-soft);
    }

    .top-banner {
      margin-bottom: 14px;
      padding: 8px 10px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      gap: 10px;
      background: radial-gradient(circle at 0 0, rgba(216, 177, 90, 0.2), transparent 70%);
      border: 1px solid rgba(191, 190, 232, 0.52);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
    }

    .top-banner-icon {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0, rgba(248, 222, 145, 1) 0, #f1ca63 30%, #8c46ff 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.7);
      color: #1d1307;
    }

    .top-banner-text {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .top-banner-text strong {
      color: var(--accent-strong);
    }

    .top-banner-kicker {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-dim);
      margin-bottom: 2px;
    }

    .app-shell-outer {
      width: 100%;
      max-width: 1120px;
    }

    .hero-block {
      padding: 10px 0 16px;
      text-align: center;
    }

    .hero-logo {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 6px;
    }

    .hero-logo-mark {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0, #f8e089 0, #f1c967 18%, #8c46ff 52%, #32127b 90%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow:
        0 0 0 1px rgba(0, 0, 0, 0.8),
        0 10px 30px rgba(0, 0, 0, 0.75);
    }

    .hero-logo-mark svg {
      width: 24px;
      height: 24px;
    }

    .hero-logo-text {
      font-size: 1rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      font-weight: 650;
    }

    .hero-logo-text span {
      color: var(--accent-strong);
    }

    .hero-headline {
      font-size: clamp(1.5rem, 2.3vw, 1.8rem);
      line-height: 1.35;
      margin: 4px 0 6px;
      font-weight: 620;
    }

    .hero-headline span {
      color: var(--accent-strong);
    }

    .hero-sub {
      font-size: 0.9rem;
      color: var(--text-soft);
      max-width: 540px;
      margin: 0 auto;
    }

    .hero-sub strong {
      color: var(--accent-strong);
    }

    @media (max-width: 720px) {
      body {
        padding: 14px 8px 28px;
      }

      .card-main {
        padding: 14px 12px 12px;
      }

      .card-main-inner {
        padding: 14px 12px 12px;
      }

      .card-sidebar {
        padding: 12px 12px 10px;
      }

      .sidebar-inner {
        padding: 12px 11px 10px;
      }

      .hero-headline {
        font-size: 1.3rem;
      }
    }
  </style>
</head>
<body>
  <div class="bg-overlay"></div>

  <div class="app-shell-outer">
    <div class="hero-block">
      <div class="hero-logo">
        <div class="hero-logo-mark">
          <svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <linearGradient id="gradEsteborg" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0%" stop-color="#f9e6a9"/>
                <stop offset="35%" stop-color="#f1c45d"/>
                <stop offset="70%" stop-color="#b37cff"/>
                <stop offset="100%" stop-color="#2c0f63"/>
              </linearGradient>
            </defs>
            <circle cx="20" cy="20" r="18" fill="url(#gradEsteborg)" />
            <path d="M14 10c3.5 0 6 3.2 6 7.5S17.5 25 14 25 8 21.8 8 17.5 10.5 10 14 10Z" fill="rgba(12,8,24,0.96)"/>
            <path d="M26 13c2.4 0 4.2 1.9 4.2 4.5S28.4 22 26 22s-4.2-1.9-4.2-4.5S23.6 13 26 13Z" fill="rgba(12,8,24,0.96)"/>
            <path d="M18 13h3.5M18 16h3.5M18 19h3.5M18 22h3.5" stroke="#f9e6a9" stroke-width="1.2" stroke-linecap="round" />
          </svg>
        </div>
        <div class="hero-logo-text">ESTEBORG <span>EXECUTIVE</span></div>
      </div>
      <div class="hero-headline">
        ¬øTu comunicaci√≥n est√° frenando tu crecimiento profesional?<br/>
        <span>Haz el Mini Diagn√≥stico Esteborg y desc√∫brelo en 2 minutos.</span>
      </div>
      <div class="hero-sub">
        Un ejercicio guiado por Esteborg, tu entrenador ejecutivo de <strong>comunicaci√≥n emocional</strong>,
        <strong>liderazgo</strong> y <strong>claridad mental</strong>.
      </div>
    </div>

    <div class="app-shell">
      <div class="card-main">
        <div class="card-main-inner">
          <div class="logo-row">
            <div class="logo-group">
              <div class="logo-mark">
                <div class="logo-mark-inner">
                  <svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                      <linearGradient id="grad2" x1="0" y1="0" x2="1" y2="1">
                        <stop offset="0%" stop-color="#f9e6a9"/>
                        <stop offset="35%" stop-color="#f1c45d"/>
                        <stop offset="70%" stop-color="#b37cff"/>
                        <stop offset="100%" stop-color="#2c0f63"/>
                      </linearGradient>
                    </defs>
                    <circle cx="20" cy="20" r="18" fill="url(#grad2)" />
                    <path d="M14 10c3.5 0 6 3.2 6 7.5S17.5 25 14 25 8 21.8 8 17.5 10.5 10 14 10Z" fill="rgba(12,8,24,0.96)"/>
                    <path d="M26 13c2.4 0 4.2 1.9 4.2 4.5S28.4 22 26 22s-4.2-1.9-4.2-4.5S23.6 13 26 13Z" fill="rgba(12,8,24,0.96)"/>
                    <path d="M18 13h3.5M18 16h3.5M18 19h3.5M18 22h3.5" stroke="#f9e6a9" stroke-width="1.2" stroke-linecap="round" />
                  </svg>
                </div>
              </div>
              <div class="logo-text-block">
                <div class="logo-title">
                  <span>ESTEBORG</span>
                  <span class="accent">COACH</span>
                </div>
                <div class="logo-subtitle">Tu mente es tu ventaja</div>
              </div>
            </div>
            <div class="logo-tag">
              <div class="logo-tag-dot"></div>
              <span>Demo guiada en tiempo real</span>
            </div>
          </div>

          <div class="headline">
            <div class="headline-kicker">
              MINI DIAGN√ìSTICO DE COMUNICACI√ìN
            </div>
            <h1 class="headline-title">
              Descubre en qu√© est√°s saboteando tu comunicaci√≥n en <span>3 pasos</span>.
            </h1>
            <p class="headline-subtitle">
              Esta demo te da una primera lectura sobre <strong>c√≥mo te comunicas hoy</strong> y
              d√≥nde puedes mejorar como l√≠der, vendedor o profesional. Si quieres trabajar a fondo, Esteborg te espera en
              <a href="https://membersvip.esteborg.live" target="_blank" rel="noopener noreferrer">Members VIP</a>.
            </p>
          </div>

          <div class="pill-row">
            <div class="pill">
              <div class="pill-icon">1</div>
              <span><strong>Habla con Esteborg</strong> sobre tu reto actual.</span>
            </div>
            <div class="pill pill-secondary">
              <div class="pill-icon">2</div>
              <span><strong>Recibe una lectura</strong> de tu comunicaci√≥n.</span>
            </div>
            <div class="pill pill-subtle">
              <div class="pill-icon">3</div>
              <span><strong>Descubre el siguiente paso</strong> para entrenarte a fondo.</span>
            </div>
          </div>

          <div class="top-banner">
            <div class="top-banner-icon">
              <span>‚ö°</span>
            </div>
            <div class="top-banner-text">
              <div class="top-banner-kicker">C√≥mo funciona</div>
              <div>
                Esta demo es <strong>gratuita y limitada</strong>. Cuando llegues al final, Esteborg te invitar√° a seguir
                en Members VIP con el entrenamiento completo de comunicaci√≥n, liderazgo y claridad mental.
              </div>
            </div>
          </div>

          <div class="layout-main">
            <div class="chat-panel">
              <div class="chat-header">
                <div class="chat-header-left">
                  <div class="chat-title">
                    Esteborg ¬∑ Comunicaci√≥n Ejecutiva
                    <span class="badge">Demo guiada</span>
                  </div>
                  <div class="chat-subtitle">
                    Responde como si hablaras con tu entrenador personal. Entre m√°s claro seas, mejor el diagn√≥stico.
                  </div>
                </div>
                <div class="chat-header-right">
                  <span class="demo-dot"></span>
                  <span>Tiempo real</span>
                </div>
              </div>

              <div id="chatBox" class="chat-box">
                <div class="msg-row">
                  <div class="bubble bubble-ai">
                    <div class="bubble-label">
                      <span class="bubble-label-dot"></span>
                      <span>Esteborg</span>
                    </div>
                    <div>
                      Antes de entrar de lleno a tu mini diagn√≥stico, dime:
                      <strong>¬øen qu√© idioma quieres que conversemos?</strong> Escribe
                      <strong>"espa√±ol"</strong> o <strong>"ingl√©s"</strong>.
                    </div>
                    <div class="bubble-meta">
                      <span>Demo ¬∑ Paso 1/3</span>
                    </div>
                  </div>
                </div>
              </div>

              <div class="starter-row" id="startersRow">
                <button class="starter-chip" data-starter="Quiero comunicarme mejor con mi equipo.">
                  <span class="starter-dot"></span>
                  <span>Quiero comunicarme mejor con mi equipo.</span>
                </button>
                <button class="starter-chip" data-starter="Quiero m√°s claridad mental para tomar decisiones importantes.">
                  <span class="starter-dot"></span>
                  <span>Quiero m√°s claridad mental para decidir.</span>
                </button>
                <button class="starter-chip" data-starter="Quiero comunicarme mejor con clientes o prospectos.">
                  <span class="starter-dot"></span>
                  <span>Quiero comunicarme mejor con clientes.</span>
                </button>
              </div>

              <div class="input-row">
                <div class="input-wrapper">
                  <input
                    id="userMsg"
                    type="text"
                    placeholder='Ej. "Quiero comunicarme mejor con mi equipo remoto..."'
                    autocomplete="off"
                  />
                  <button class="mic-btn" id="micBtn" type="button" title="Hablar con tu voz">
                    <svg viewBox="0 0 24 24">
                      <path
                        d="M12 4a2 2 0 0 0-2 2v4a2 2 0 1 0 4 0V6a2 2 0 0 0-2-2Zm-4 6a4 4 0 1 0 8 0h-1.5a2.5 2.5 0 1 1-5 0H8Z"
                        fill="currentColor"
                      />
                      <path
                        d="M11 15.95V19h2v-3.05a6.002 6.002 0 0 0 5-5.9h-2a4 4 0 1 1-8 0H6a6.002 6.002 0 0 0 5 5.9Z"
                        fill="currentColor"
                      />
                    </svg>
                  </button>
                </div>
                <button id="sendBtn" type="button">
                  <span class="icon">‚û§</span>
                  <span>Enviar a Esteborg</span>
                </button>
              </div>

              <div class="status-row">
                <div id="demoStatus">
                  <span class="status-dot"></span>
                  <span>Demo activa ¬∑ primeras interacciones</span>
                </div>
                <button id="ttsToggle" type="button">
                  <span>üîä Voz Esteborg</span>
                </button>
              </div>

              <div class="demo-note">
                Esta demo est√° limitada. Cuando llegue al final, Esteborg te invitar√° a continuar en
                <a href="https://membersvip.esteborg.live" target="_blank" rel="noopener noreferrer">Members VIP</a>
                con el entrenamiento completo.
              </div>
            </div>

            <div class="sidebar">
              <div class="card-sidebar">
                <div class="sidebar-inner">
                  <div class="sidebar-header">
                    <div class="badge-mini">
                      <span class="badge-demo-dot"></span>
                      <span>Qu√© vas a experimentar</span>
                    </div>
                    <div class="sidebar-title">
                      Esteborg en modo demo de comunicaci√≥n.
                    </div>
                    <div class="sidebar-sub">
                      Esta versi√≥n demo se enfoca en <strong>c√≥mo te comunicas hoy</strong> y qu√© podr√≠as ajustar para
                      tener m√°s impacto al hablar con tu equipo, clientes o l√≠deres.
                    </div>
                  </div>

                  <div class="divider"></div>

                  <div class="steps">
                    <div class="step-card">
                      <div class="step-pill">
                        <div class="step-pill-dot"></div>
                        <span>Paso 1 ¬∑ Lenguaje y contexto</span>
                      </div>
                      <div class="step-title">Elegimos idioma y entendemos tu reto.</div>
                      <div class="step-text">
                        Esteborg te har√° una o dos preguntas simples para ubicar
                        <strong>d√≥nde est√°s</strong>: comunicaci√≥n con tu equipo, con clientes o contigo mismo.
                      </div>
                    </div>
                    <div class="step-card alt">
                      <div class="step-pill">
                        <div class="step-pill-dot"></div>
                        <span>Paso 2 ¬∑ Micro diagn√≥stico</span>
                      </div>
                      <div class="step-title">Te da una primera lectura accionable.</div>
                      <div class="step-text">
                        Recibes una <strong>perspectiva clara y directa</strong> sobre patrones que podr√≠an estar
                        frenando tu comunicaci√≥n y un siguiente paso concreto.
                      </div>
                    </div>
                  </div>

                  <div class="metric-row">
                    <div class="metric-group">
                      <div class="metric-item">
                        <div class="metric-label">Duraci√≥n</div>
                        <div class="metric-value">
                          <span>2‚Äì4 minutos</span>
                          <span class="small">por demo</span>
                        </div>
                      </div>
                      <div class="metric-item">
                        <div class="metric-label">Enfoque</div>
                        <div class="metric-value">
                          <span>Comunicaci√≥n, liderazgo, claridad</span>
                        </div>
                      </div>
                    </div>
                    <div>
                      <div class="metric-label">Modo completo</div>
                      <div class="metric-pill">
                        <span class="metric-dot"></span>
                        <span>Disponible en Members VIP</span>
                      </div>
                    </div>
                  </div>

                  <div class="cta-members">
                    ¬øQuieres que Esteborg te acompa√±e varios d√≠as seguidos? Pru√©balo en modo completo en
                    <a href="https://membersvip.esteborg.live" target="_blank" rel="noopener noreferrer">
                      Members VIP
                    </a>.
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card-sidebar">
        <div class="sidebar-inner">
          <div class="headline-top">
            Mini Diagn√≥stico ¬∑ <span>Comunicaci√≥n, liderazgo y claridad</span>
          </div>
          <div class="headline-main">
            En 2 minutos Esteborg te da una lectura sincera sobre <span>c√≥mo te est√°s comunicando hoy</span>.
          </div>
          <div class="headline-support">
            No es terapia, no es coaching infinito. Es un espejo ejecutivo para que veas en qu√© est√°s
            <strong>perdiendo impacto al hablar</strong> con tu equipo, tus clientes o tus l√≠deres.
          </div>

          <div class="divider" style="margin-top: 12px;"></div>

          <div class="steps">
            <div class="step-card">
              <div class="step-pill">
                <div class="step-pill-dot"></div>
                <span>¬øPara qui√©n es?</span>
              </div>
              <div class="step-title">L√≠deres, vendedores y profesionales con responsabilidad.</div>
              <div class="step-text">
                Personas que ya tienen <strong>cierto nivel</strong>, pero sienten que su forma de comunicar frena su
                crecimiento, sus ventas o su autoridad.
              </div>
            </div>

            <div class="step-card alt">
              <div class="step-pill">
                <div class="step-pill-dot"></div>
                <span>Qu√© NO hace</span>
              </div>
              <div class="step-title">No reemplaza procesos profundos.</div>
              <div class="step-text">
                No es terapia ni consultor√≠a legal. Es un <strong>inicio</strong> para que tomes consciencia y decidas
                si quieres entrenarte a profundidad con Esteborg.
              </div>
            </div>
          </div>

          <div class="metric-row" style="margin-top: 12px;">
            <div class="metric-group">
              <div class="metric-item">
                <div class="metric-label">Formato</div>
                <div class="metric-value">
                  <span>Chat guiado + voz</span>
                </div>
              </div>
              <div class="metric-item">
                <div class="metric-label">Interacciones</div>
                <div class="metric-value">
                  <span>Demo limitada</span>
                  <span class="small">hasta 14 turnos</span>
                </div>
              </div>
            </div>
            <div>
              <div class="metric-label">Siguiente paso</div>
              <div class="metric-pill">
                <span class="metric-dot"></span>
                <span>Entrar a Members VIP</span>
              </div>
            </div>
          </div>

          <div class="cta-members" style="margin-top: 12px;">
            Esta demo te mostrar√° solo una parte de lo que Esteborg puede hacer contigo. Si al final sientes que te habl√≥
            directo, el siguiente paso natural es <strong>activar tu acceso a Members VIP</strong>.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const doc = document;

    const chatBox = doc.getElementById("chatBox");
    const userMsgInput = doc.getElementById("userMsg");
    const sendBtn = doc.getElementById("sendBtn");
    const demoStatusEl = doc.getElementById("demoStatus");
    const ttsToggleBtn = doc.getElementById("ttsToggle");
    const micBtn = doc.getElementById("micBtn");

    const API_URL = "https://esteborgcom7-backend.onrender.com/api/demo/welcome";

    let history = [];
    let isSending = false;
    let demoEnded = false;
    let userName = null;

    // 1 = idioma, 2 = nombre, 3 = conversaci√≥n normal
    let introStep = 1;

    let currentLang = "es"; // "es" o "en"
    let ttsEnabled = true;
    let currentAudio = null;

    const startersRow = doc.getElementById("startersRow");
    if (startersRow) {
      startersRow.querySelectorAll(".starter-chip").forEach((chip) => {
        chip.addEventListener("click", () => handleStarterClick(chip));
      });
    }

    function handleStarterClick(chip) {
      if (!chip) return;
      if (demoEnded || isSending) return;

      const val = chip.getAttribute("data-starter") || chip.textContent || "";
      if (!val.trim()) return;

      if (introStep < 3) {
        appendMessage(
          "assistant",
          "Primero terminemos las preguntas iniciales de idioma y nombre, luego podemos usar tus retos como ejemplo."
        );
        return;
      }

      userMsgInput.value = val;
      sendMessage();
    }

    function formatTextWithLinks(text) {
      if (!text) return "";
      const urlRegex =
        /(https?:\/\/[^\s]+)|(www\.[^\s]+)|(membersvip\.esteborg\.live[^\s]*)/gi;

      return text.replace(urlRegex, (match) => {
        let url = match;
        if (!/^https?:\/\//i.test(url)) {
          if (url.startsWith("www.")) {
            url = "https://" + url;
          } else if (url.startsWith("membersvip.esteborg.live")) {
            url = "https://" + url;
          }
        }
        return `<a href="${url}" target="_blank" rel="noopener noreferrer">${match}</a>`;
      });
    }

    function appendMessage(role, text, meta) {
      const row = doc.createElement("div");
      row.className = "msg-row " + (role === "user" ? "user" : "ai");

      const bubble = doc.createElement("div");
      bubble.className = "bubble " + (role === "user" ? "bubble-user" : "bubble-ai");

      const label = doc.createElement("div");
      label.className = "bubble-label";
      const dot = doc.createElement("span");
      dot.className = "bubble-label-dot";
      const who = doc.createElement("span");

      if (role === "user") {
        who.textContent = userName ? userName : "T√∫";
      } else {
        who.textContent = "Esteborg";
      }

      label.appendChild(dot);
      label.appendChild(who);
      bubble.appendChild(label);

      const content = doc.createElement("div");
      if (role === "assistant") {
        content.innerHTML = formatTextWithLinks(text);
      } else {
        content.textContent = text;
      }
      bubble.appendChild(content);

      if (meta) {
        const metaDiv = doc.createElement("div");
        metaDiv.className = "bubble-meta";
        metaDiv.textContent = meta;
        bubble.appendChild(metaDiv);
      }

      row.appendChild(bubble);
      chatBox.appendChild(row);
      chatBox.scrollTop = chatBox.scrollHeight;

      if (role === "assistant") {
        speakFromApi(text);
      }
    }

    function updateDemoStatus(text, ended) {
      if (!demoStatusEl) return;

      demoStatusEl.innerHTML = "";

      const dot = doc.createElement("span");
      dot.className = "status-dot";
      if (ended) {
        dot.classList.add("ended");
      }

      const label = doc.createElement("span");
      label.textContent = text;

      demoStatusEl.appendChild(dot);
      demoStatusEl.appendChild(label);
    }

    function setDemoStatus(status, remaining) {
      if (status === "ended") {
        updateDemoStatus("Demo finalizada ¬∑ activa tu acceso en Members VIP", true);
        demoEnded = true;
        sendBtn.disabled = true;
        userMsgInput.disabled = true;
        return;
      }

      if (typeof remaining === "number") {
        if (remaining <= 0) {
          updateDemoStatus("Demo finalizada ¬∑ activa tu acceso en Members VIP", true);
          demoEnded = true;
          sendBtn.disabled = true;
          userMsgInput.disabled = true;
        } else if (remaining <= 3) {
          updateDemoStatus("Demo activa ¬∑ √∫ltimas " + remaining + " interacciones", false);
        } else {
          updateDemoStatus("Demo activa ¬∑ " + remaining + " interacciones restantes", false);
        }
      } else {
        updateDemoStatus("Demo activa ¬∑ primeras interacciones", false);
      }
    }

    function detectLangChoice(message) {
      const text = (message || "").toLowerCase();

      if (text.includes("english") || text.includes("ingl√©s") || text.includes("ingles")) {
        return "en";
      }

      if (text.includes("spanish") || text.includes("espa√±ol") || text.includes("espanol")) {
        return "es";
      }

      if (text.includes("en") && text.includes("english")) return "en";
      if (text.includes("es") && text.includes("espa√±ol")) return "es";

      return currentLang || "es";
    }

    function formatLangForBackend(lang) {
      if ((lang || "").toLowerCase().startsWith("en")) return "en";
      return "es";
    }

    async function speakFromApi(text) {
      if (!ttsEnabled || !text) return;

      try {
        const trimmed = text.length > 400 ? text.slice(0, 400) : text;

        const res = await fetch("https://esteborgcom7-backend.onrender.com/api/tts", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text: trimmed, lang: currentLang })
        });

        if (!res.ok) {
          console.error("TTS API error", await res.text());
          return;
        }

        const blob = await res.blob();
        const url = URL.createObjectURL(blob);

        if (currentAudio) {
          try {
            currentAudio.pause();
            currentAudio.currentTime = 0;
          } catch (e) {
            console.warn("Error al detener audio previo:", e);
          }
        }

        currentAudio = new Audio(url);
        currentAudio.play();
      } catch (e) {
        console.error("Error al reproducir TTS externo:", e);
      }
    }

    function setLoading(isLoading) {
      isSending = isLoading;
      sendBtn.disabled = isLoading || demoEnded;
      userMsgInput.disabled = demoEnded;

      if (isLoading) {
        sendBtn.innerHTML = '<span class="icon">‚è≥</span><span>Pensando...</span>';
      } else {
        sendBtn.innerHTML = '<span class="icon">‚û§</span><span>Enviar a Esteborg</span>';
      }
    }

    async function sendMessage() {
      if (isSending || demoEnded) return;

      const message = userMsgInput.value.trim();
      if (!message) return;

      appendMessage("user", message);
      userMsgInput.value = "";

      if (introStep === 1) {
        currentLang = detectLangChoice(message);
        const langLabel = currentLang === "en" ? "en ingl√©s" : "en espa√±ol";

        const reply =
          currentLang === "en"
            ? `Perfect. We'll talk in English. What's your first name?`
            : `Perfecto. Hablaremos ${langLabel}. ¬øC√≥mo te llamas?`;

        introStep = 2;
        appendMessage("assistant", reply, "Demo ¬∑ Paso 2/3");
        return;
      }

      if (introStep === 2) {
        userName = message
          .split(" ")
          .map((p) => p.trim())
          .filter((p) => p)
          .slice(0, 2)
          .join(" ");

        const reply =
          currentLang === "en"
            ? `Thanks, ${userName}. Now tell me in one sentence what you want to improve first: your communication, your leadership or your mental clarity.`
            : `Gracias, ${userName}. Ahora dime en una sola frase qu√© quieres mejorar primero: tu comunicaci√≥n, tu liderazgo o tu claridad mental.`;

        introStep = 3;
        appendMessage("assistant", reply, "Demo ¬∑ Paso 3/3");
        return;
      }

      setLoading(true);

      try {
        const payload = {
          message,
          userName: userName || "",
          history,
          lang: formatLangForBackend(currentLang),
        };

        const res = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(payload),
        });

        if (!res.ok) {
          console.error("Error en backend demo:", await res.text());
          const fallbackMsg =
            currentLang === "en"
              ? "There was a connection issue. Try again in a few seconds."
              : "Hubo un problema de conexi√≥n. Vuelve a intentar en unos segundos.";
          appendMessage("assistant", fallbackMsg);
          return;
        }

        const data = await res.json();

        if (data && data.reply) {
          appendMessage("assistant", data.reply);
          history.push({ role: "user", content: message });
          history.push({ role: "assistant", content: data.reply });

          if (data.demoStatus) {
            const remaining = typeof data.remainingInteractions === "number"
              ? data.remainingInteractions
              : null;

            if (data.demoStatus === "ended") {
              setDemoStatus("ended", 0);
            } else {
              if (remaining !== null && remaining <= 3) {
                setDemoStatus("active", remaining);
              } else {
                setDemoStatus("active", remaining);
              }
            }
          }
        } else {
          const fallbackMsg =
            currentLang === "en"
              ? "I couldn't process the response correctly. Try asking in a different way."
              : "No pude procesar bien la respuesta. Intenta preguntarlo de otra forma.";
          appendMessage("assistant", fallbackMsg);
        }
      } catch (err) {
        console.error("Error al llamar al backend:", err);
        const fallbackMsg =
          currentLang === "en"
            ? "There was a connection issue. Try again in a few seconds."
            : "Hubo un problema de conexi√≥n. Vuelve a intentar en unos segundos.";
        appendMessage("assistant", fallbackMsg);
      } finally {
        setLoading(false);
      }
    }

    sendBtn.addEventListener("click", () => sendMessage());

    userMsgInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    ttsToggleBtn.addEventListener("click", () => {
      ttsEnabled = !ttsEnabled;
      if (ttsEnabled) {
        ttsToggleBtn.classList.remove("off");
        ttsToggleBtn.innerHTML = "<span>üîä Voz Esteborg</span>";
      } else {
        ttsToggleBtn.classList.add("off");
        ttsToggleBtn.innerHTML = "<span>üîá Voz desactivada</span>";
        if (currentAudio) {
          try {
            currentAudio.pause();
            currentAudio.currentTime = 0;
          } catch (e) {
            console.warn("Error al detener audio:", e);
          }
        }
      }
    });

    function setupVoiceInput() {
      if (!("webkitSpeechRecognition" in window) && !("SpeechRecognition" in window)) {
        if (micBtn) {
          micBtn.style.display = "none";
        }
        return;
      }

      const SpeechRecognition =
        window.SpeechRecognition || window.webkitSpeechRecognition;
      const recognition = new SpeechRecognition();

      recognition.lang = "es-MX";
      recognition.continuous = false;
      recognition.interimResults = false;

      let isRecording = false;

      function updateMicState(recording) {
        isRecording = recording;
        if (micBtn) {
          if (recording) {
            micBtn.classList.add("recording");
          } else {
            micBtn.classList.remove("recording");
          }
        }
      }

      if (micBtn) {
        micBtn.addEventListener("click", () => {
          if (isRecording) {
            recognition.stop();
            updateMicState(false);
          } else {
            try {
              recognition.start();
              updateMicState(true);
            } catch (e) {
              console.warn("Error al iniciar reconocimiento de voz:", e);
              updateMicState(false);
            }
          }
        });
      }

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        userMsgInput.value = transcript;
      };

      recognition.onerror = () => {
        updateMicState(false);
      };

      recognition.onend = () => {
        updateMicState(false);
      };
    }

    setupVoiceInput();
    renderStarters();

    function renderStarters() {
      // ya se instancian arriba con data-starter, esta funci√≥n queda
      // por compatibilidad si quieres agregar din√°micamente m√°s chips
    }
  </script>
</body>
</html>
